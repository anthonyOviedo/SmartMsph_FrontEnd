import * as tslib_1 from "tslib";
import { Component, Input, Output, EventEmitter, ViewEncapsulation, ChangeDetectionStrategy } from '@angular/core';
import * as momentNs from 'moment';
var moment = momentNs;
import { extendMoment } from 'moment-range';
var range = extendMoment(moment).range;
var CalendarComponent = /** @class */ (function () {
    function CalendarComponent() {
        this.singleCalendar = false;
        this.dateChanged = new EventEmitter();
        this.monthChanged = new EventEmitter();
        this.yearChanged = new EventEmitter();
    }
    Object.defineProperty(CalendarComponent.prototype, "monthText", {
        get: function () {
            return moment.monthsShort()[this.month];
        },
        enumerable: true,
        configurable: true
    });
    CalendarComponent.prototype.ngOnChanges = function () {
        this.createCalendarGridData();
    };
    CalendarComponent.prototype.getWeekNumbers = function (monthRange) {
        var weekNumbers = [];
        var weeks = Array.from(monthRange.by('weeks'));
        for (var i = 0; i < weeks.length; i++) {
            var week = weeks[i];
            if (i < 5) {
                weekNumbers.push(week.week());
            }
            else {
                break;
            }
        }
        return weekNumbers;
    };
    CalendarComponent.prototype.getWeeksRange = function (weeks) {
        var weeksRange = [];
        for (var i = 0; i < weeks.length; i++) {
            var week = weeks[i];
            var firstWeekDay = moment([this.year, this.month]).week(week).day(0);
            ;
            var lastWeekDay = moment([this.year, this.month]).week(week).day(6);
            ;
            if (i > 0 && week < weeks[i - 1]) {
                firstWeekDay.add(1, 'year');
                lastWeekDay.add(1, 'year');
            }
            weeksRange.push(range(firstWeekDay.week(week).day(0), lastWeekDay.week(week).day(6)));
        }
        return weeksRange;
    };
    CalendarComponent.prototype.createCalendarGridData = function () {
        var _this = this;
        var firstDay = moment([this.year, this.month]).startOf('month');
        var endDay = moment([this.year, this.month]).add(1, 'month').endOf('month');
        var monthRange = range(firstDay, endDay);
        var weeksRange = this.getWeeksRange(this.getWeekNumbers(monthRange));
        var weekList = [];
        weeksRange.map(function (week) {
            var daysList = [];
            Array.from(week.by('days')).forEach(function (day) {
                if (day.isSame(_this.minDate, 'date')) {
                    day = _this.minDate;
                }
                else if (day.isSame(_this.maxDate, 'date')) {
                    day = _this.maxDate;
                }
                ;
                daysList.push(day);
            });
            weekList.push(daysList);
        });
        this.weekList = weekList;
    };
    CalendarComponent.prototype.isDisabled = function (day) {
        return (day.isBefore(this.minDate) || day.isAfter(this.maxDate)) || (day.isBefore(this.selectedFromDate) && !this.isLeft);
    };
    CalendarComponent.prototype.isDateAvailable = function (day) {
        if (this.isLeft) {
            return day.isSameOrBefore(this.selectedToDate, 'date') && !day.isSameOrBefore(this.minDate, 'date');
        }
        return day.isSameOrAfter(this.selectedFromDate, 'date') && !day.isSameOrAfter(this.maxDate, 'date');
    };
    CalendarComponent.prototype.isSelectedDate = function (day) {
        var date = this.isLeft ? this.selectedFromDate : this.selectedToDate;
        return date && day.get('month') === this.month && day.isSame(date, 'date');
    };
    CalendarComponent.prototype.isDateInRange = function (day) {
        if (this.isLeft) {
            if (!this.selectedToDate) {
                return this.selectedFromDate && day.get('month') === this.month && day.isSameOrAfter(this.selectedFromDate, 'date');
            }
        }
        if (this.selectedFromDate) {
            return this.selectedToDate && day.get('month') === this.month && day.isSameOrBefore(this.selectedToDate, 'date') && day.isSameOrAfter(this.selectedFromDate, 'date');
        }
    };
    CalendarComponent.prototype.isDifferentMonth = function (day) {
        return day.get('month') !== this.month;
    };
    CalendarComponent.prototype.dateSelected = function (event, data) {
        this.dateChanged.emit({
            day: data.day,
            isLeft: this.isLeft
        });
        event.stopPropagation();
    };
    CalendarComponent.prototype.monthSelected = function (event, data) {
        this.monthChanged.emit({
            value: data.value,
            isLeft: this.isLeft
        });
        event.stopPropagation();
    };
    CalendarComponent.prototype.yearSelected = function (event, data) {
        this.yearChanged.emit({
            value: data.value,
            isLeft: this.isLeft
        });
        event.stopPropagation();
    };
    tslib_1.__decorate([
        Input()
    ], CalendarComponent.prototype, "month", void 0);
    tslib_1.__decorate([
        Input()
    ], CalendarComponent.prototype, "year", void 0);
    tslib_1.__decorate([
        Input()
    ], CalendarComponent.prototype, "selectedFromDate", void 0);
    tslib_1.__decorate([
        Input()
    ], CalendarComponent.prototype, "selectedToDate", void 0);
    tslib_1.__decorate([
        Input()
    ], CalendarComponent.prototype, "isLeft", void 0);
    tslib_1.__decorate([
        Input()
    ], CalendarComponent.prototype, "format", void 0);
    tslib_1.__decorate([
        Input()
    ], CalendarComponent.prototype, "minDate", void 0);
    tslib_1.__decorate([
        Input()
    ], CalendarComponent.prototype, "maxDate", void 0);
    tslib_1.__decorate([
        Input()
    ], CalendarComponent.prototype, "singleCalendar", void 0);
    tslib_1.__decorate([
        Input()
    ], CalendarComponent.prototype, "icons", void 0);
    tslib_1.__decorate([
        Output()
    ], CalendarComponent.prototype, "dateChanged", void 0);
    tslib_1.__decorate([
        Output()
    ], CalendarComponent.prototype, "monthChanged", void 0);
    tslib_1.__decorate([
        Output()
    ], CalendarComponent.prototype, "yearChanged", void 0);
    CalendarComponent = tslib_1.__decorate([
        Component({
            changeDetection: ChangeDetectionStrategy.OnPush,
            encapsulation: ViewEncapsulation.None,
            selector: 'calendar',
            template: "<div class=\"row\">\n  <div class=\"col text-center\">\n    <div class=\"d-flex align-items-center calendar-pagination {{ icons === 'material' ? 'material' : '' }}\">\n      <div>\n        <button type=\"button\" class=\"btn btn-link btn-previous-year\" (click)=\"yearSelected($event, { value: -1 })\">\n          <i *ngIf=\"icons === 'material'\" class=\"material-icons\">first_page</i>\n          <i *ngIf=\"icons === 'font-awesome'\" class=\"fas fa-angle-double-left\"></i>\n          <img *ngIf=\"icons === 'default'\" src=\"data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeD0iMHB4IiB5PSIwcHgiIHZpZXdCb3g9IjAgMCA0MDcuNDM2IDQwNy40MzYiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDQwNy40MzYgNDA3LjQzNjsiIHhtbDpzcGFjZT0icHJlc2VydmUiIHdpZHRoPSIxNnB4IiBoZWlnaHQ9IjE2cHgiPgo8Zz4KCTxwb2x5Z29uIHBvaW50cz0iMjY2LjQ1MiwyMS4xNzggMjQ1LjIwNCwwIDQyLjE0OSwyMDMuNzE4IDI0NS4yMDQsNDA3LjQzNiAyNjYuNDUyLDM4Ni4yNTggODQuNTA3LDIwMy43MTggICIgZmlsbD0iIzAwMDAwMCIvPgoJPHBvbHlnb24gcG9pbnRzPSIzNjUuMjg2LDIxLjE3OCAzNDQuMDM4LDAgMTQwLjk4MywyMDMuNzE4IDM0NC4wMzgsNDA3LjQzNiAzNjUuMjg2LDM4Ni4yNTggMTgzLjM0MSwyMDMuNzE4ICAiIGZpbGw9IiMwMDAwMDAiLz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8Zz4KPC9nPgo8L3N2Zz4K\" />\n        </button>\n      </div>\n      <div>\n        <button type=\"button\" class=\"btn btn-link btn-previous-month\" (click)=\"monthSelected($event, { value: -1 })\">\n          <i *ngIf=\"icons === 'material'\" class=\"material-icons\">chevron_left</i>\n          <i *ngIf=\"icons === 'font-awesome'\" class=\"fas fa-angle-left\"></i>\n          <img *ngIf=\"icons === 'default'\" src=\"data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCIgdmlld0JveD0iMCAwIDQ0NC41MzEgNDQ0LjUzMSIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNDQ0LjUzMSA0NDQuNTMxOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxnPgoJPHBhdGggZD0iTTIxMy4xMywyMjIuNDA5TDM1MS44OCw4My42NTNjNy4wNS03LjA0MywxMC41NjctMTUuNjU3LDEwLjU2Ny0yNS44NDFjMC0xMC4xODMtMy41MTgtMTguNzkzLTEwLjU2Ny0yNS44MzUgICBsLTIxLjQwOS0yMS40MTZDMzIzLjQzMiwzLjUyMSwzMTQuODE3LDAsMzA0LjYzNywwcy0xOC43OTEsMy41MjEtMjUuODQxLDEwLjU2MUw5Mi42NDksMTk2LjQyNSAgIGMtNy4wNDQsNy4wNDMtMTAuNTY2LDE1LjY1Ni0xMC41NjYsMjUuODQxczMuNTIxLDE4Ljc5MSwxMC41NjYsMjUuODM3bDE4Ni4xNDYsMTg1Ljg2NGM3LjA1LDcuMDQzLDE1LjY2LDEwLjU2NCwyNS44NDEsMTAuNTY0ICAgczE4Ljc5NS0zLjUyMSwyNS44MzQtMTAuNTY0bDIxLjQwOS0yMS40MTJjNy4wNS03LjAzOSwxMC41NjctMTUuNjA0LDEwLjU2Ny0yNS42OTdjMC0xMC4wODUtMy41MTgtMTguNzQ2LTEwLjU2Ny0yNS45NzggICBMMjEzLjEzLDIyMi40MDl6IiBmaWxsPSIjMDAwMDAwIi8+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg==\" />\n        </button>\n      </div>\n      <div class=\"flex-grow-1 month-year\">\n        {{ monthText }} {{ year }}\n      </div>\n      <div>\n        <button type=\"button\" class=\"btn btn-link btn-next-month\" (click)=\"monthSelected($event, { value: 1 })\">\n          <i *ngIf=\"icons === 'material'\" class=\"material-icons\">chevron_right</i>\n          <i *ngIf=\"icons === 'font-awesome'\" class=\"fas fa-angle-right\"></i>\n          <img *ngIf=\"icons === 'default'\" src=\"data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCIgdmlld0JveD0iMCAwIDQ0NC44MTkgNDQ0LjgxOSIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNDQ0LjgxOSA0NDQuODE5OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxnPgoJPHBhdGggZD0iTTM1Mi4wMjUsMTk2LjcxMkwxNjUuODg0LDEwLjg0OEMxNTkuMDI5LDMuNjE1LDE1MC40NjksMCwxNDAuMTg3LDBjLTEwLjI4MiwwLTE4Ljg0MiwzLjYxOS0yNS42OTcsMTAuODQ4TDkyLjc5MiwzMi4yNjQgICBjLTcuMDQ0LDcuMDQzLTEwLjU2NiwxNS42MDQtMTAuNTY2LDI1LjY5MmMwLDkuODk3LDMuNTIxLDE4LjU2LDEwLjU2NiwyNS45ODFsMTM4Ljc1MywxMzguNDczTDkyLjc4NiwzNjEuMTY4ICAgYy03LjA0Miw3LjA0My0xMC41NjQsMTUuNjA0LTEwLjU2NCwyNS42OTNjMCw5Ljg5NiwzLjUyMSwxOC41NjIsMTAuNTY0LDI1Ljk4bDIxLjcsMjEuNDEzICAgYzcuMDQzLDcuMDQzLDE1LjYxMiwxMC41NjQsMjUuNjk3LDEwLjU2NGMxMC4wODksMCwxOC42NTYtMy41MjEsMjUuNjk3LTEwLjU2NGwxODYuMTQ1LTE4NS44NjQgICBjNy4wNDYtNy40MjMsMTAuNTcxLTE2LjA4NCwxMC41NzEtMjUuOTgxQzM2Mi41OTcsMjEyLjMyMSwzNTkuMDcxLDIwMy43NTUsMzUyLjAyNSwxOTYuNzEyeiIgZmlsbD0iIzAwMDAwMCIvPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+Cjwvc3ZnPgo=\" />\n        </button>\n      </div>\n      <div>\n        <button type=\"button\" class=\"btn btn-link btn-next-year\" (click)=\"yearSelected($event, { value: 1 })\">\n          <i *ngIf=\"icons === 'material'\" class=\"material-icons\">last_page</i>\n          <i *ngIf=\"icons === 'font-awesome'\" class=\"fas fa-angle-double-right\"></i>\n          <img *ngIf=\"icons === 'default'\" src=\"data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeD0iMHB4IiB5PSIwcHgiIHZpZXdCb3g9IjAgMCA0MDcuNDM2IDQwNy40MzYiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDQwNy40MzYgNDA3LjQzNjsiIHhtbDpzcGFjZT0icHJlc2VydmUiIHdpZHRoPSIxNnB4IiBoZWlnaHQ9IjE2cHgiPgo8Zz4KCTxwb2x5Z29uIHBvaW50cz0iMTYyLjIzMSwwIDE0MC45ODMsMjEuMTc4IDMyMi45MjksMjAzLjcxOCAxNDAuOTgzLDM4Ni4yNTggMTYyLjIzMSw0MDcuNDM2IDM2NS4yODYsMjAzLjcxOCAgIiBmaWxsPSIjMDAwMDAwIi8+Cgk8cG9seWdvbiBwb2ludHM9IjYzLjM5NywwIDQyLjE0OSwyMS4xNzggMjI0LjA5NSwyMDMuNzE4IDQyLjE0OSwzODYuMjU4IDYzLjM5Nyw0MDcuNDM2IDI2Ni40NTIsMjAzLjcxOCAgIiBmaWxsPSIjMDAwMDAwIi8+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg==\" />\n        </button>\n      </div>\n    </div>\n  </div>\n</div>\n\n<div class=\"row\">\n  <div class=\"col\">\n    <table class=\"table table-borderless mb-0\">\n      <thead>\n        <tr class=\"week-days\">\n          <th>Sun</th>\n          <th>Mon</th>\n          <th>Tue</th>\n          <th>Wed</th>\n          <th>Thu</th>\n          <th>Fri</th>\n          <th>Sat</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr *ngFor=\"let week of weekList; let i = index\">\n          <td *ngFor=\"let day of weekList[i]\" (click)=\"dateSelected($event, { day: day })\" [ngClass]=\"{ 'selected': isSelectedDate(day), 'in-selected-range': isDateInRange(day), 'disabled': isDisabled(day), 'different-month': isDifferentMonth(day) }\">\n            {{ day.format('D') }}\n          </td>\n        </tr>\n      </tbody>\n    </table>\n  </div>\n</div>\n",
            styles: [".calendar.calendar-single .table td.in-selected-range{background-color:transparent}.calendar .calendar-pagination{font-size:16px;margin:.5rem -15px 0}.calendar .calendar-pagination.material .btn.btn-previous-year{padding-right:3px}.calendar .calendar-pagination.material .btn.btn-previous-month{padding-left:0}.calendar .calendar-pagination.material .btn.btn-next-month{padding-right:0}.calendar .calendar-pagination.material .btn.btn-next-year{padding-left:3px}.calendar .calendar-pagination .month-year{font-weight:600}.calendar .week-days{text-transform:uppercase}.calendar .table td,.calendar .table th{border-radius:0;color:#333;font-size:12px;height:36px;line-height:1;padding:0;text-align:center;vertical-align:middle}.calendar .table th{font-weight:400}.calendar .table td{border-radius:5px;cursor:pointer;font-weight:900;width:32px;max-width:32px}.calendar .table td:not(.disabled):not(.selected):hover{background-color:#eee;color:#333}.calendar .table td.selected{background-color:#003d79;border-radius:5px;color:#fff;font-size:12px}.calendar .table td.selected.in-selected-range{background-color:#003d79;border-radius:5px}.calendar .table td.selected:hover{background-color:#003d79}.calendar .table td.in-selected-range{background-color:#dfefff;border-radius:0;font-size:12px}.calendar .table td.disabled{background-color:transparent;color:#666;cursor:not-allowed;font-weight:400}.calendar .table td.different-month{color:#888;font-weight:500}.calendar .table td.different-month.disabled{color:#ccc}"]
        })
    ], CalendarComponent);
    return CalendarComponent;
}());
export { CalendarComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LWRhdGVyYW5nZS8iLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvY2FsZW5kYXIvY2FsZW5kYXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFhLGlCQUFpQixFQUFFLHVCQUF1QixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTlILE9BQU8sS0FBSyxRQUFRLE1BQU0sUUFBUSxDQUFDO0FBQUMsSUFBTSxNQUFNLEdBQUcsUUFBUSxDQUFDO0FBRTVELE9BQU8sRUFBRSxZQUFZLEVBQWEsTUFBTSxjQUFjLENBQUM7QUFHL0MsSUFBQSxrQ0FBSyxDQUEwQjtBQVd2QztJQVRBO1FBb0NJLG1CQUFjLEdBQUcsS0FBSyxDQUFDO1FBTXZCLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQWdCLENBQUM7UUFHL0MsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBZ0IsQ0FBQztRQUdoRCxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFnQixDQUFDO0lBd0luRCxDQUFDO0lBcElHLHNCQUFJLHdDQUFTO2FBQWI7WUFDRSxPQUFPLE1BQU0sQ0FBQyxXQUFXLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDMUMsQ0FBQzs7O09BQUE7SUFFRCx1Q0FBVyxHQUFYO1FBQ0UsSUFBSSxDQUFDLHNCQUFzQixFQUFFLENBQUM7SUFDaEMsQ0FBQztJQUVELDBDQUFjLEdBQWQsVUFBZSxVQUFxQjtRQUNsQyxJQUFNLFdBQVcsR0FBRyxFQUFFLENBQUM7UUFDdkIsSUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFFakQsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssQ0FB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dUIsQ0FBQyxNQUFNO1lBQy9DLGFBQWEsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO1lBQ3JDLFFBQVEsRUFBRSxVQUFVO1lBSXBCLDIxUEFBd0M7O1NBQ3pDLENBQUM7T0FDVyxpQkFBaUIsQ0ErSzdCO0lBQUQsd0JBQUM7Q0FBQSxBQS9LRCxJQStLQztTQS9LWSxpQkFBaUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgT25DaGFuZ2VzLCBWaWV3RW5jYXBzdWxhdGlvbiwgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0ICogYXMgbW9tZW50TnMgZnJvbSAnbW9tZW50JzsgY29uc3QgbW9tZW50ID0gbW9tZW50TnM7XG5cbmltcG9ydCB7IGV4dGVuZE1vbWVudCwgRGF0ZVJhbmdlIH0gZnJvbSAnbW9tZW50LXJhbmdlJztcbmltcG9ydCB7IElDaGFuZ2VkRGF0YSwgSURhdGVSYW5nZSB9IGZyb20gJy4uLy4uL2ludGVyZmFjZXMnO1xuXG5jb25zdCB7IHJhbmdlIH0gPSBleHRlbmRNb21lbnQobW9tZW50KTtcblxuQENvbXBvbmVudCh7XG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxuICBzZWxlY3RvcjogJ2NhbGVuZGFyJyxcbiAgc3R5bGVVcmxzOiBbXG4gICAgJy4vY2FsZW5kYXIuY29tcG9uZW50LnNjc3MnLFxuICBdLFxuICB0ZW1wbGF0ZVVybDogJy4vY2FsZW5kYXIuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIENhbGVuZGFyQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzIHtcblxuICAgIEBJbnB1dCgpXG4gICAgbW9udGg6IG51bWJlcjtcblxuICAgIEBJbnB1dCgpXG4gICAgeWVhcjogbnVtYmVyO1xuXG4gICAgQElucHV0KClcbiAgICBzZWxlY3RlZEZyb21EYXRlOiBtb21lbnROcy5Nb21lbnQ7XG5cbiAgICBASW5wdXQoKVxuICAgIHNlbGVjdGVkVG9EYXRlOiBtb21lbnROcy5Nb21lbnQ7XG5cbiAgICBASW5wdXQoKVxuICAgIGlzTGVmdDogYm9vbGVhbjtcblxuICAgIEBJbnB1dCgpXG4gICAgZm9ybWF0OiBzdHJpbmc7XG5cbiAgICBASW5wdXQoKVxuICAgIG1pbkRhdGU6IG1vbWVudE5zLk1vbWVudDtcblxuICAgIEBJbnB1dCgpXG4gICAgbWF4RGF0ZTogbW9tZW50TnMuTW9tZW50O1xuXG4gICAgQElucHV0KClcbiAgICBzaW5nbGVDYWxlbmRhciA9IGZhbHNlO1xuXG4gICAgQElucHV0KClcbiAgICBpY29uczogc3RyaW5nO1xuXG4gICAgQE91dHB1dCgpXG4gICAgZGF0ZUNoYW5nZWQgPSBuZXcgRXZlbnRFbWl0dGVyPElDaGFuZ2VkRGF0YT4oKTtcblxuICAgIEBPdXRwdXQoKVxuICAgIG1vbnRoQ2hhbmdlZCA9IG5ldyBFdmVudEVtaXR0ZXI8SUNoYW5nZWREYXRhPigpO1xuXG4gICAgQE91dHB1dCgpXG4gICAgeWVhckNoYW5nZWQgPSBuZXcgRXZlbnRFbWl0dGVyPElDaGFuZ2VkRGF0YT4oKTtcblxuICAgIHdlZWtMaXN0OiBJRGF0ZVJhbmdlW107XG5cbiAgICBnZXQgbW9udGhUZXh0KCkge1xuICAgICAgcmV0dXJuIG1vbWVudC5tb250aHNTaG9ydCgpW3RoaXMubW9udGhdO1xuICAgIH1cblxuICAgIG5nT25DaGFuZ2VzKCk6IHZvaWQge1xuICAgICAgdGhpcy5jcmVhdGVDYWxlbmRhckdyaWREYXRhKCk7XG4gICAgfVxuXG4gICAgZ2V0V2Vla051bWJlcnMobW9udGhSYW5nZTogRGF0ZVJhbmdlKTogbnVtYmVyW10ge1xuICAgICAgY29uc3Qgd2Vla051bWJlcnMgPSBbXTtcbiAgICAgIGNvbnN0IHdlZWtzID0gQXJyYXkuZnJvbShtb250aFJhbmdlLmJ5KCd3ZWVrcycpKTtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3ZWVrcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCB3ZWVrID0gd2Vla3NbaV07XG5cbiAgICAgICAgaWYgKGkgPCA1KSB7XG4gICAgICAgICAgd2Vla051bWJlcnMucHVzaCh3ZWVrLndlZWsoKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHdlZWtOdW1iZXJzO1xuICAgIH1cblxuICAgIGdldFdlZWtzUmFuZ2Uod2Vla3M6IG51bWJlcltdKTogRGF0ZVJhbmdlW10ge1xuICAgICAgY29uc3Qgd2Vla3NSYW5nZSA9IFtdO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdlZWtzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHdlZWsgPSB3ZWVrc1tpXTtcbiAgICAgICAgbGV0IGZpcnN0V2Vla0RheSA9IG1vbWVudChbdGhpcy55ZWFyLCB0aGlzLm1vbnRoXSkud2Vlayh3ZWVrKS5kYXkoMCk7O1xuICAgICAgICBsZXQgbGFzdFdlZWtEYXkgPSBtb21lbnQoW3RoaXMueWVhciwgdGhpcy5tb250aF0pLndlZWsod2VlaykuZGF5KDYpOztcblxuICAgICAgICBpZiAoaSA+IDAgJiYgd2VlayA8IHdlZWtzW2kgLSAxXSkge1xuICAgICAgICAgIGZpcnN0V2Vla0RheS5hZGQoMSwgJ3llYXInKTtcbiAgICAgICAgICBsYXN0V2Vla0RheS5hZGQoMSwgJ3llYXInKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHdlZWtzUmFuZ2UucHVzaChyYW5nZShmaXJzdFdlZWtEYXkud2Vlayh3ZWVrKS5kYXkoMCksIGxhc3RXZWVrRGF5LndlZWsod2VlaykuZGF5KDYpKSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB3ZWVrc1JhbmdlO1xuICAgIH1cblxuICAgIGNyZWF0ZUNhbGVuZGFyR3JpZERhdGEoKTogdm9pZCB7XG4gICAgICBjb25zdCBmaXJzdERheSA9IG1vbWVudChbdGhpcy55ZWFyLCB0aGlzLm1vbnRoXSkuc3RhcnRPZignbW9udGgnKTtcbiAgICAgIGNvbnN0IGVuZERheSA9IG1vbWVudChbdGhpcy55ZWFyLCB0aGlzLm1vbnRoXSkuYWRkKDEsICdtb250aCcpLmVuZE9mKCdtb250aCcpO1xuICAgICAgY29uc3QgbW9udGhSYW5nZSA9IHJhbmdlKGZpcnN0RGF5LCBlbmREYXkpO1xuICAgICAgY29uc3Qgd2Vla3NSYW5nZSA9IHRoaXMuZ2V0V2Vla3NSYW5nZSh0aGlzLmdldFdlZWtOdW1iZXJzKG1vbnRoUmFuZ2UpKTtcbiAgICAgIGNvbnN0IHdlZWtMaXN0ID0gW107XG5cbiAgICAgIHdlZWtzUmFuZ2UubWFwKHdlZWsgPT4ge1xuICAgICAgICBjb25zdCBkYXlzTGlzdCA9IFtdO1xuXG4gICAgICAgIEFycmF5LmZyb20od2Vlay5ieSgnZGF5cycpKS5mb3JFYWNoKChkYXk6IG1vbWVudE5zLk1vbWVudCkgPT4ge1xuICAgICAgICAgIGlmIChkYXkuaXNTYW1lKHRoaXMubWluRGF0ZSwgJ2RhdGUnKSkge1xuICAgICAgICAgICAgZGF5ID0gdGhpcy5taW5EYXRlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmIChkYXkuaXNTYW1lKHRoaXMubWF4RGF0ZSwgJ2RhdGUnKSkge1xuICAgICAgICAgICAgZGF5ID0gdGhpcy5tYXhEYXRlO1xuICAgICAgICAgIH07XG5cbiAgICAgICAgICBkYXlzTGlzdC5wdXNoKGRheSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHdlZWtMaXN0LnB1c2goZGF5c0xpc3QpO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMud2Vla0xpc3QgPSB3ZWVrTGlzdDtcbiAgfVxuXG4gIGlzRGlzYWJsZWQoZGF5OiBtb21lbnROcy5Nb21lbnQpOiBib29sZWFuIHtcbiAgICByZXR1cm4gKGRheS5pc0JlZm9yZSh0aGlzLm1pbkRhdGUpIHx8IGRheS5pc0FmdGVyKHRoaXMubWF4RGF0ZSkpIHx8IChkYXkuaXNCZWZvcmUodGhpcy5zZWxlY3RlZEZyb21EYXRlKSAmJiAhdGhpcy5pc0xlZnQpO1xuICB9XG5cbiAgaXNEYXRlQXZhaWxhYmxlKGRheTogbW9tZW50TnMuTW9tZW50KTogYm9vbGVhbiB7XG4gICAgaWYgKHRoaXMuaXNMZWZ0KSB7XG4gICAgICByZXR1cm4gZGF5LmlzU2FtZU9yQmVmb3JlKHRoaXMuc2VsZWN0ZWRUb0RhdGUsICdkYXRlJykgJiYgIWRheS5pc1NhbWVPckJlZm9yZSh0aGlzLm1pbkRhdGUsICdkYXRlJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGRheS5pc1NhbWVPckFmdGVyKHRoaXMuc2VsZWN0ZWRGcm9tRGF0ZSwgJ2RhdGUnKSAmJiAhZGF5LmlzU2FtZU9yQWZ0ZXIodGhpcy5tYXhEYXRlLCAnZGF0ZScpO1xuICB9XG5cbiAgaXNTZWxlY3RlZERhdGUoZGF5OiBtb21lbnROcy5Nb21lbnQpOiBib29sZWFuIHtcbiAgICBjb25zdCBkYXRlID0gdGhpcy5pc0xlZnQgPyB0aGlzLnNlbGVjdGVkRnJvbURhdGUgOiB0aGlzLnNlbGVjdGVkVG9EYXRlO1xuXG4gICAgcmV0dXJuIGRhdGUgJiYgZGF5LmdldCgnbW9udGgnKSA9PT0gdGhpcy5tb250aCAmJiBkYXkuaXNTYW1lKGRhdGUsICdkYXRlJyk7XG4gIH1cblxuICBpc0RhdGVJblJhbmdlKGRheTogbW9tZW50TnMuTW9tZW50KTogYm9vbGVhbiB7XG4gICAgaWYgKHRoaXMuaXNMZWZ0KSB7XG4gICAgICBpZiAoIXRoaXMuc2VsZWN0ZWRUb0RhdGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWRGcm9tRGF0ZSAmJiBkYXkuZ2V0KCdtb250aCcpID09PSB0aGlzLm1vbnRoICYmIGRheS5pc1NhbWVPckFmdGVyKHRoaXMuc2VsZWN0ZWRGcm9tRGF0ZSwgJ2RhdGUnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5zZWxlY3RlZEZyb21EYXRlKSB7XG4gICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZFRvRGF0ZSAmJiBkYXkuZ2V0KCdtb250aCcpID09PSB0aGlzLm1vbnRoICYmIGRheS5pc1NhbWVPckJlZm9yZSh0aGlzLnNlbGVjdGVkVG9EYXRlLCAnZGF0ZScpICYmIGRheS5pc1NhbWVPckFmdGVyKHRoaXMuc2VsZWN0ZWRGcm9tRGF0ZSwgJ2RhdGUnKTtcbiAgICB9XG4gIH1cblxuICBpc0RpZmZlcmVudE1vbnRoKGRheTogbW9tZW50TnMuTW9tZW50KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGRheS5nZXQoJ21vbnRoJykgIT09IHRoaXMubW9udGg7XG4gIH1cblxuICBkYXRlU2VsZWN0ZWQoZXZlbnQ6IEV2ZW50LCBkYXRhOiBJQ2hhbmdlZERhdGEpOiB2b2lkIHtcbiAgICB0aGlzLmRhdGVDaGFuZ2VkLmVtaXQoe1xuICAgICAgZGF5OiBkYXRhLmRheSxcbiAgICAgIGlzTGVmdDogdGhpcy5pc0xlZnRcbiAgICB9KTtcblxuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICB9XG5cbiAgbW9udGhTZWxlY3RlZChldmVudDogRXZlbnQsIGRhdGE6IElDaGFuZ2VkRGF0YSk6IHZvaWQge1xuICAgIHRoaXMubW9udGhDaGFuZ2VkLmVtaXQoe1xuICAgICAgdmFsdWU6IGRhdGEudmFsdWUsXG4gICAgICBpc0xlZnQ6IHRoaXMuaXNMZWZ0XG4gICAgfSk7XG5cbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgfVxuXG4gIHllYXJTZWxlY3RlZChldmVudDogRXZlbnQsIGRhdGE6IElDaGFuZ2VkRGF0YSk6IHZvaWQge1xuICAgIHRoaXMueWVhckNoYW5nZWQuZW1pdCh7XG4gICAgICB2YWx1ZTogZGF0YS52YWx1ZSxcbiAgICAgIGlzTGVmdDogdGhpcy5pc0xlZnRcbiAgICB9KTtcblxuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICB9XG59XG4iXX0=